<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avatar Golf Practice Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="ci-logo">
                    <img src="CI.png" alt="아바타골프" class="logo-image">
                </div>
            </div>
            <div class="title-section">
                <h1 class="app-title">
                    <i class="fas fa-golf-ball-tee"></i>
                    아바타골프
                </h1>
            </div>
            <div class="version-section">
                <span class="version-badge">v1.0.1</span>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="navigation">
        <div class="nav-content">
            <button class="nav-item active" data-tab="practice">
                <i class="fas fa-golf-ball"></i>
                연습기록
            </button>
            <button class="nav-item" data-tab="records">
                <i class="fas fa-chart-line"></i>
                기록보기
            </button>
            <button class="nav-item" data-tab="analysis">
                <i class="fas fa-analytics"></i>
                분석
            </button>
            <button class="nav-item" data-tab="members">
                <i class="fas fa-users"></i>
                멤버관리
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Practice Recording Tab -->
        <section id="practice" class="tab-content active">
            <div class="container">
                <h2 class="section-title">골프 연습 기록</h2>
                
                <div class="practice-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>연습자</label>
                            <div class="radio-group user-radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="userSelect" value="오세민" class="radio-input">
                                    <span class="radio-custom"></span>
                                    오세민
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="userSelect" value="조재현" class="radio-input">
                                    <span class="radio-custom"></span>
                                    조재현
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>클럽</label>
                            <div class="radio-group club-radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="clubSelect" value="드라이버" class="radio-input">
                                    <span class="radio-custom"></span>
                                    드라이버
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="clubSelect" value="7번아이언" class="radio-input">
                                    <span class="radio-custom"></span>
                                    7번아이언
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="clubSelect" value="8번아이언" class="radio-input">
                                    <span class="radio-custom"></span>
                                    8번아이언
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="clubSelect" value="9번아이언" class="radio-input">
                                    <span class="radio-custom"></span>
                                    9번아이언
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="clubSelect" value="피칭웨지" class="radio-input">
                                    <span class="radio-custom"></span>
                                    피칭웨지
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="clubSelect" value="샌드웨지" class="radio-input">
                                    <span class="radio-custom"></span>
                                    샌드웨지
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="clubSelect" value="퍼터" class="radio-input">
                                    <span class="radio-custom"></span>
                                    퍼터
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="practiceDate">연습 날짜</label>
                        <input type="date" id="practiceDate" class="form-control">
                    </div>

                    <div class="form-group">
                        <label for="distance">거리 (미터)</label>
                        <input type="number" id="distance" class="form-control" placeholder="예: 30" min="1" max="300">
                    </div>

                    <div class="form-group">
                        <label>연습 유형</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="practiceType" value="accuracy" class="radio-input">
                                <span class="radio-custom"></span>
                                정확도 연습 (성공/실패)
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="practiceType" value="distance" class="radio-input">
                                <span class="radio-custom"></span>
                                거리 연습 (정확한 거리 측정)
                            </label>
                        </div>
                    </div>

                    <!-- Accuracy Practice -->
                    <div id="accuracyPractice" class="practice-details" style="display: none;">
                        <div class="form-group">
                            <label for="totalAttempts">총 시도 횟수</label>
                            <select id="totalAttempts" class="form-control">
                                <option value="">시도 횟수를 선택하세요</option>
                                <option value="5">5회</option>
                                <option value="10">10회</option>
                                <option value="15">15회</option>
                                <option value="20">20회</option>
                                <option value="25">25회</option>
                                <option value="30">30회</option>
                                <option value="40">40회</option>
                                <option value="50">50회</option>
                            </select>
                        </div>
                        <div id="accuracyResults" class="accuracy-results" style="display: none;">
                            <h4>결과 입력</h4>
                            <div id="attemptButtons" class="attempt-buttons">
                                <!-- 동적으로 생성될 버튼들 -->
                            </div>
                            <div class="accuracy-summary">
                                <span>성공: <span id="successCount">0</span>회</span>
                                <span>실패: <span id="failureCount">0</span>회</span>
                                <span>성공률: <span id="successRate">0</span>%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Distance Practice -->
                    <div id="distancePractice" class="practice-details" style="display: none;">
                        <div class="form-group">
                            <label for="targetDistance">목표 거리 (미터)</label>
                            <input type="number" id="targetDistance" class="form-control" placeholder="예: 5.0" step="0.1" min="0.1" max="300">
                        </div>
                        <div class="form-group">
                            <label for="attemptCount">시도 횟수</label>
                            <select id="attemptCount" class="form-control">
                                <option value="">시도 횟수를 선택하세요</option>
                                <option value="5">5회</option>
                                <option value="10">10회</option>
                                <option value="15">15회</option>
                                <option value="20">20회</option>
                                <option value="25">25회</option>
                                <option value="30">30회</option>
                            </select>
                        </div>
                        <div id="distanceResults" class="distance-results" style="display: none;">
                            <h4>거리 기록 입력</h4>
                            <div id="distanceInputs" class="distance-inputs">
                                <!-- 동적으로 생성될 입력 필드들 -->
                            </div>
                            <div class="distance-summary">
                                <span>평균: <span id="averageDistance">0</span>m</span>
                                <span>최소: <span id="minDistance">0</span>m</span>
                                <span>최대: <span id="maxDistance">0</span>m</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="notes">메모</label>
                        <textarea id="notes" class="form-control" placeholder="연습 중 느낀 점이나 개선사항을 기록하세요" rows="3"></textarea>
                    </div>

                    <button id="savePractice" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        기록 저장
                    </button>
                </div>
            </div>
        </section>

        <!-- Records View Tab -->
        <section id="records" class="tab-content">
            <div class="container">
                <h2 class="section-title">연습 기록 보기</h2>
                
                <div class="filters">
                    <div class="filter-group">
                        <label for="filterUser">연습자</label>
                        <select id="filterUser" class="form-control">
                            <option value="">전체</option>
                            <option value="오세민">오세민</option>
                            <option value="조재현">조재현</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterClub">클럽</label>
                        <select id="filterClub" class="form-control">
                            <option value="">전체</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterDate">날짜</label>
                        <input type="date" id="filterDate" class="form-control">
                    </div>
                </div>

                <div id="recordsList" class="records-list">
                    <!-- Records will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Analysis Tab -->
        <section id="analysis" class="tab-content">
            <div class="container">
                <h2 class="section-title">연습 분석</h2>
                
                <div class="analysis-cards">
                    <div class="analysis-card">
                        <h3>전체 통계</h3>
                        <div id="overallStats" class="stats-content">
                            <!-- Overall stats will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="analysis-card">
                        <h3>클럽별 성과</h3>
                        <div id="clubStats" class="stats-content">
                            <!-- Club stats will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="analysis-card">
                        <h3>진보 추이</h3>
                        <div id="progressChart" class="chart-container">
                            <!-- Progress chart will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Members Tab -->
        <section id="members" class="tab-content">
            <div class="container">
                <h2 class="section-title">멤버 관리</h2>
                
                <div class="members-list">
                    <div class="member-card">
                        <div class="member-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="member-info">
                            <h3>오세민</h3>
                            <p>골프 연습생</p>
                            <div class="member-stats">
                                <span>총 연습: <strong id="oseminTotal">0</strong>회</span>
                                <span>성공률: <strong id="oseminSuccess">0</strong>%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="member-card">
                        <div class="member-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="member-info">
                            <h3>조재현</h3>
                            <p>골프 연습생</p>
                            <div class="member-stats">
                                <span>총 연습: <strong id="jaehyunTotal">0</strong>회</span>
                                <span>성공률: <strong id="jaehyunSuccess">0</strong>%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <i class="fas fa-golf-ball-tee fa-spin"></i>
            <p>데이터를 처리중입니다...</p>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyDMbj9r4C3fghOTWYDH89iYuFYi0K7T9xs",
            authDomain: "avatargolf-eb431.firebaseapp.com",
            projectId: "avatargolf-eb431",
            storageBucket: "avatargolf-eb431.firebasestorage.app",
            messagingSenderId: "682801274137",
            appId: "1:682801274137:web:612bb6c65cdeb6bd8b3988"
        };

        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 전역 변수
        let practiceRecords = [];

        // DOM 요소들
        const practiceTypeRadios = document.querySelectorAll('input[name="practiceType"]');
        const accuracyPractice = document.getElementById('accuracyPractice');
        const distancePractice = document.getElementById('distancePractice');
        const saveButton = document.getElementById('savePractice');
        const navItems = document.querySelectorAll('.nav-item');
        const tabContents = document.querySelectorAll('.tab-content');
        const practiceDateInput = document.getElementById('practiceDate');
        const totalAttemptsSelect = document.getElementById('totalAttempts');
        const attemptCountSelect = document.getElementById('attemptCount');

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // 오늘 날짜를 기본값으로 설정
            const today = new Date().toISOString().split('T')[0];
            practiceDateInput.value = today;
            
            // 연습 유형 라디오 버튼 이벤트
            practiceTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const selectedType = this.value;
                    
                    accuracyPractice.style.display = selectedType === 'accuracy' ? 'block' : 'none';
                    distancePractice.style.display = selectedType === 'distance' ? 'block' : 'none';
                });
            });
            
            // 정확도 연습 시도 횟수 선택 이벤트
            totalAttemptsSelect.addEventListener('change', function() {
                const attempts = parseInt(this.value);
                if (attempts > 0) {
                    generateAccuracyButtons(attempts);
                    document.getElementById('accuracyResults').style.display = 'block';
                } else {
                    document.getElementById('accuracyResults').style.display = 'none';
                }
            });
            
            // 거리 연습 시도 횟수 선택 이벤트
            attemptCountSelect.addEventListener('change', function() {
                const attempts = parseInt(this.value);
                if (attempts > 0) {
                    generateDistanceInputs(attempts);
                    document.getElementById('distanceResults').style.display = 'block';
                } else {
                    document.getElementById('distanceResults').style.display = 'none';
                }
            });
        });

        // 네비게이션 탭 전환
        navItems.forEach(item => {
            item.addEventListener('click', function() {
                const targetTab = this.dataset.tab;
                
                // 모든 탭 비활성화
                navItems.forEach(nav => nav.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // 선택된 탭 활성화
                this.classList.add('active');
                document.getElementById(targetTab).classList.add('active');
                
                // 탭별 데이터 로드
                if (targetTab === 'records') {
                    loadRecords();
                } else if (targetTab === 'analysis') {
                    loadAnalysis();
                } else if (targetTab === 'members') {
                    loadMemberStats();
                }
            });
        });

        // 정확도 연습 버튼 생성
        function generateAccuracyButtons(attempts) {
            const container = document.getElementById('attemptButtons');
            container.innerHTML = '';
            
            for (let i = 1; i <= attempts; i++) {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'attempt-btn';
                button.textContent = i;
                button.dataset.attempt = i;
                button.dataset.result = '';
                
                button.addEventListener('click', function() {
                    if (this.dataset.result === '') {
                        this.dataset.result = 'success';
                        this.textContent = 'O';
                        this.className = 'attempt-btn success';
                    } else if (this.dataset.result === 'success') {
                        this.dataset.result = 'failure';
                        this.textContent = 'X';
                        this.className = 'attempt-btn failure';
                    } else {
                        this.dataset.result = '';
                        this.textContent = i;
                        this.className = 'attempt-btn';
                    }
                    updateAccuracySummary();
                });
                
                container.appendChild(button);
            }
        }
        
        // 거리 입력 필드 생성
        function generateDistanceInputs(attempts) {
            const container = document.getElementById('distanceInputs');
            container.innerHTML = '';
            
            for (let i = 1; i <= attempts; i++) {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'distance-input-group';
                
                const label = document.createElement('label');
                label.textContent = `${i}번째:`;
                
                const input = document.createElement('input');
                input.type = 'number';
                input.className = 'form-control distance-input';
                input.placeholder = '0.0';
                input.step = '0.1';
                input.min = '0.1';
                input.dataset.attempt = i;
                
                input.addEventListener('input', updateDistanceSummary);
                
                inputGroup.appendChild(label);
                inputGroup.appendChild(input);
                container.appendChild(inputGroup);
            }
        }
        
        // 정확도 요약 업데이트
        function updateAccuracySummary() {
            const buttons = document.querySelectorAll('.attempt-btn');
            let successCount = 0;
            let failureCount = 0;
            
            buttons.forEach(btn => {
                if (btn.dataset.result === 'success') successCount++;
                else if (btn.dataset.result === 'failure') failureCount++;
            });
            
            const totalAttempts = successCount + failureCount;
            const successRate = totalAttempts > 0 ? ((successCount / totalAttempts) * 100).toFixed(1) : 0;
            
            document.getElementById('successCount').textContent = successCount;
            document.getElementById('failureCount').textContent = failureCount;
            document.getElementById('successRate').textContent = successRate;
        }
        
        // 거리 요약 업데이트
        function updateDistanceSummary() {
            const inputs = document.querySelectorAll('.distance-input');
            const distances = [];
            
            inputs.forEach(input => {
                const value = parseFloat(input.value);
                if (!isNaN(value) && value > 0) {
                    distances.push(value);
                }
            });
            
            if (distances.length > 0) {
                const average = (distances.reduce((a, b) => a + b, 0) / distances.length).toFixed(2);
                const min = Math.min(...distances).toFixed(2);
                const max = Math.max(...distances).toFixed(2);
                
                document.getElementById('averageDistance').textContent = average;
                document.getElementById('minDistance').textContent = min;
                document.getElementById('maxDistance').textContent = max;
            } else {
                document.getElementById('averageDistance').textContent = '0';
                document.getElementById('minDistance').textContent = '0';
                document.getElementById('maxDistance').textContent = '0';
            }
        }

        // 연습 기록 저장
        saveButton.addEventListener('click', async function() {
            const user = document.querySelector('input[name="userSelect"]:checked')?.value;
            const club = document.querySelector('input[name="clubSelect"]:checked')?.value;
            const distance = document.getElementById('distance').value;
            const practiceType = document.querySelector('input[name="practiceType"]:checked')?.value;
            const practiceDate = document.getElementById('practiceDate').value;
            const notes = document.getElementById('notes').value;

            // 유효성 검사
            if (!user || !club || !distance || !practiceType) {
                showToast('모든 필수 항목을 입력해주세요.', 'error');
                return;
            }

            showLoading(true);

            try {
                const practiceData = {
                    user: user,
                    club: club,
                    distance: parseInt(distance),
                    practiceType: practiceType,
                    notes: notes,
                    timestamp: new Date(),
                    date: practiceDate
                };

                if (practiceType === 'accuracy') {
                    const totalAttempts = parseInt(totalAttemptsSelect.value);
                    const successCount = parseInt(document.getElementById('successCount').textContent);
                    const failureCount = parseInt(document.getElementById('failureCount').textContent);
                    
                    if (totalAttempts === 0 || (successCount + failureCount) === 0) {
                        showToast('정확도 연습의 결과를 입력해주세요.', 'error');
                        showLoading(false);
                        return;
                    }
                    
                    practiceData.totalAttempts = totalAttempts;
                    practiceData.successCount = successCount;
                    practiceData.failureCount = failureCount;
                    practiceData.successRate = ((successCount / (successCount + failureCount)) * 100).toFixed(1);
                } else if (practiceType === 'distance') {
                    const attemptCount = parseInt(attemptCountSelect.value);
                    const targetDistance = parseFloat(document.getElementById('targetDistance').value);
                    const distanceInputs = document.querySelectorAll('.distance-input');
                    const distances = [];
                    
                    distanceInputs.forEach(input => {
                        const value = parseFloat(input.value);
                        if (!isNaN(value) && value > 0) {
                            distances.push(value);
                        }
                    });
                    
                    if (attemptCount === 0 || distances.length === 0) {
                        showToast('거리 연습의 결과를 입력해주세요.', 'error');
                        showLoading(false);
                        return;
                    }
                    
                    practiceData.attemptCount = attemptCount;
                    practiceData.targetDistance = targetDistance;
                    practiceData.distances = distances;
                    practiceData.averageDistance = (distances.reduce((a, b) => a + b, 0) / distances.length).toFixed(2);
                    practiceData.minDistance = Math.min(...distances).toFixed(2);
                    practiceData.maxDistance = Math.max(...distances).toFixed(2);
                }

                // Firebase에 저장
                await addDoc(collection(db, 'practiceRecords'), practiceData);
                
                showToast('연습 기록이 성공적으로 저장되었습니다!', 'success');
                clearForm();
                
            } catch (error) {
                console.error('Error saving practice record:', error);
                showToast('기록 저장 중 오류가 발생했습니다.', 'error');
            } finally {
                showLoading(false);
            }
        });

        // 폼 초기화
        function clearForm() {
            // 라디오 버튼 초기화
            document.querySelectorAll('input[name="userSelect"]').forEach(radio => radio.checked = false);
            document.querySelectorAll('input[name="clubSelect"]').forEach(radio => radio.checked = false);
            document.querySelectorAll('input[name="practiceType"]').forEach(radio => radio.checked = false);
            
            // 입력 필드 초기화
            document.getElementById('distance').value = '';
            document.getElementById('practiceDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('notes').value = '';
            
            // 정확도 연습 초기화
            totalAttemptsSelect.value = '';
            document.getElementById('accuracyResults').style.display = 'none';
            document.getElementById('attemptButtons').innerHTML = '';
            
            // 거리 연습 초기화
            document.getElementById('targetDistance').value = '';
            attemptCountSelect.value = '';
            document.getElementById('distanceResults').style.display = 'none';
            document.getElementById('distanceInputs').innerHTML = '';
            
            // 연습 유형 섹션 숨김
            accuracyPractice.style.display = 'none';
            distancePractice.style.display = 'none';
        }

        // 기록 로드
        async function loadRecords() {
            showLoading(true);
            
            try {
                const q = query(collection(db, 'practiceRecords'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                
                practiceRecords = [];
                querySnapshot.forEach((doc) => {
                    practiceRecords.push({ id: doc.id, ...doc.data() });
                });
                
                displayRecords();
                
            } catch (error) {
                console.error('Error loading records:', error);
                showToast('기록을 불러오는 중 오류가 발생했습니다.', 'error');
            } finally {
                showLoading(false);
            }
        }

        // 기록 표시
        function displayRecords() {
            const recordsList = document.getElementById('recordsList');
            
            if (practiceRecords.length === 0) {
                recordsList.innerHTML = '<div class="no-records">아직 기록된 연습이 없습니다.</div>';
                return;
            }
            
            recordsList.innerHTML = practiceRecords.map(record => {
                const date = new Date(record.timestamp.seconds * 1000).toLocaleDateString('ko-KR');
                const time = new Date(record.timestamp.seconds * 1000).toLocaleTimeString('ko-KR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                let recordDetails = '';
                if (record.practiceType === 'accuracy') {
                    recordDetails = `
                        <div class="record-detail">
                            <span class="detail-label">시도:</span>
                            <span class="detail-value">${record.totalAttempts}회</span>
                        </div>
                        <div class="record-detail">
                            <span class="detail-label">성공:</span>
                            <span class="detail-value">${record.successCount}회</span>
                        </div>
                        <div class="record-detail">
                            <span class="detail-label">성공률:</span>
                            <span class="detail-value success-rate">${record.successRate}%</span>
                        </div>
                    `;
                } else if (record.practiceType === 'distance') {
                    recordDetails = `
                        <div class="record-detail">
                            <span class="detail-label">시도:</span>
                            <span class="detail-value">${record.attemptCount}회</span>
                        </div>
                        <div class="record-detail">
                            <span class="detail-label">평균거리:</span>
                            <span class="detail-value">${record.averageDistance}m</span>
                        </div>
                        <div class="record-detail">
                            <span class="detail-label">범위:</span>
                            <span class="detail-value">${record.minDistance}m ~ ${record.maxDistance}m</span>
                        </div>
                    `;
                }
                
                return `
                    <div class="record-card">
                        <div class="record-header">
                            <div class="record-user">${record.user}</div>
                            <div class="record-date">${date} ${time}</div>
                        </div>
                        <div class="record-content">
                            <div class="record-club">${record.club}</div>
                            <div class="record-distance">${record.distance}m</div>
                            ${recordDetails}
                            ${record.notes ? `<div class="record-notes">${record.notes}</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 분석 데이터 로드
        async function loadAnalysis() {
            showLoading(true);
            
            try {
                const querySnapshot = await getDocs(collection(db, 'practiceRecords'));
                const allRecords = [];
                querySnapshot.forEach((doc) => {
                    allRecords.push(doc.data());
                });
                
                displayAnalysis(allRecords);
                
            } catch (error) {
                console.error('Error loading analysis:', error);
                showToast('분석 데이터를 불러오는 중 오류가 발생했습니다.', 'error');
            } finally {
                showLoading(false);
            }
        }

        // 분석 표시
        function displayAnalysis(records) {
            // 전체 통계
            const totalRecords = records.length;
            const totalAttempts = records.reduce((sum, record) => {
                return sum + (record.totalAttempts || record.attemptCount || 0);
            }, 0);
            
            const accuracyRecords = records.filter(r => r.practiceType === 'accuracy');
            const totalSuccess = accuracyRecords.reduce((sum, record) => sum + (record.successCount || 0), 0);
            const totalAccuracyAttempts = accuracyRecords.reduce((sum, record) => sum + (record.totalAttempts || 0), 0);
            const overallSuccessRate = totalAccuracyAttempts > 0 ? (totalSuccess / totalAccuracyAttempts * 100).toFixed(1) : 0;
            
            document.getElementById('overallStats').innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${totalRecords}</div>
                    <div class="stat-label">총 연습 세션</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${totalAttempts}</div>
                    <div class="stat-label">총 시도 횟수</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${overallSuccessRate}%</div>
                    <div class="stat-label">전체 성공률</div>
                </div>
            `;
            
            // 클럽별 통계
            const clubStats = {};
            records.forEach(record => {
                if (!clubStats[record.club]) {
                    clubStats[record.club] = {
                        totalRecords: 0,
                        totalAttempts: 0,
                        totalSuccess: 0,
                        totalAccuracyAttempts: 0
                    };
                }
                
                clubStats[record.club].totalRecords++;
                clubStats[record.club].totalAttempts += (record.totalAttempts || record.attemptCount || 0);
                
                if (record.practiceType === 'accuracy') {
                    clubStats[record.club].totalSuccess += (record.successCount || 0);
                    clubStats[record.club].totalAccuracyAttempts += (record.totalAttempts || 0);
                }
            });
            
            const clubStatsHTML = Object.entries(clubStats).map(([club, stats]) => {
                const successRate = stats.totalAccuracyAttempts > 0 ? 
                    (stats.totalSuccess / stats.totalAccuracyAttempts * 100).toFixed(1) : 0;
                
                return `
                    <div class="club-stat">
                        <div class="club-name">${club}</div>
                        <div class="club-details">
                            <span>${stats.totalRecords}회 연습</span>
                            <span>성공률: ${successRate}%</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('clubStats').innerHTML = clubStatsHTML || '<div class="no-data">아직 데이터가 없습니다.</div>';
        }

        // 멤버 통계 로드
        async function loadMemberStats() {
            try {
                const querySnapshot = await getDocs(collection(db, 'practiceRecords'));
                const allRecords = [];
                querySnapshot.forEach((doc) => {
                    allRecords.push(doc.data());
                });
                
                // 오세민 통계
                const oseminRecords = allRecords.filter(r => r.user === '오세민');
                const oseminTotal = oseminRecords.length;
                const oseminAccuracyRecords = oseminRecords.filter(r => r.practiceType === 'accuracy');
                const oseminTotalAttempts = oseminAccuracyRecords.reduce((sum, r) => sum + (r.totalAttempts || 0), 0);
                const oseminTotalSuccess = oseminAccuracyRecords.reduce((sum, r) => sum + (r.successCount || 0), 0);
                const oseminSuccessRate = oseminTotalAttempts > 0 ? (oseminTotalSuccess / oseminTotalAttempts * 100).toFixed(1) : 0;
                
                // 조재현 통계
                const jaehyunRecords = allRecords.filter(r => r.user === '조재현');
                const jaehyunTotal = jaehyunRecords.length;
                const jaehyunAccuracyRecords = jaehyunRecords.filter(r => r.practiceType === 'accuracy');
                const jaehyunTotalAttempts = jaehyunAccuracyRecords.reduce((sum, r) => sum + (r.totalAttempts || 0), 0);
                const jaehyunTotalSuccess = jaehyunAccuracyRecords.reduce((sum, r) => sum + (r.successCount || 0), 0);
                const jaehyunSuccessRate = jaehyunTotalAttempts > 0 ? (jaehyunTotalSuccess / jaehyunTotalAttempts * 100).toFixed(1) : 0;
                
                document.getElementById('oseminTotal').textContent = oseminTotal;
                document.getElementById('oseminSuccess').textContent = oseminSuccessRate;
                document.getElementById('jaehyunTotal').textContent = jaehyunTotal;
                document.getElementById('jaehyunSuccess').textContent = jaehyunSuccessRate;
                
            } catch (error) {
                console.error('Error loading member stats:', error);
            }
        }

        // 로딩 표시
        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = show ? 'flex' : 'none';
        }

        // 토스트 알림
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            toastContainer.appendChild(toast);
            
            // 3초 후 자동 제거
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // 페이지 로드 시 초기화 (기존 코드는 제거됨 - 라디오 버튼으로 변경)
    </script>
</body>
</html>
